{
	"name": "Challenge",
	"events": [
		{
			"eventType": "group",
			"disabled": false,
			"title": "Server Signalling",
			"description": "Manages connecting to the signalling server and joining the room.",
			"isActiveOnStart": true,
			"children": [
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "on-start-of-layout",
							"objectClass": "System",
							"sid": 127263528010556
						}
					],
					"actions": [
						{
							"id": "connect",
							"objectClass": "Multiplayer",
							"sid": 988076740943711,
							"parameters": {
								"server": "\"wss://multiplayer.scirra.com\""
							}
						},
						{
							"id": "wait",
							"objectClass": "System",
							"sid": 258433439012182,
							"parameters": {
								"seconds": "2"
							}
						},
						{
							"callFunction": "WriteMessageStatus",
							"sid": 168412617208874,
							"parameters": [
								"\"Connecting to server...\""
							]
						}
					],
					"sid": 697404280647422
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "on-connected",
							"objectClass": "Multiplayer",
							"sid": 383781163004158
						}
					],
					"actions": [
						{
							"callFunction": "WriteMessageStatus",
							"sid": 894415927471582,
							"parameters": [
								"\"Connected, logging in...\""
							]
						},
						{
							"id": "wait",
							"objectClass": "System",
							"sid": 258433439012182,
							"parameters": {
								"seconds": "2"
							}
						},
						{
							"id": "log-in",
							"objectClass": "Multiplayer",
							"sid": 486565086436052,
							"parameters": {
								"alias": "User_ID"
							}
						}
					],
					"sid": 407209889213145
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "on-logged-in",
							"objectClass": "Multiplayer",
							"sid": 549380773134083
						}
					],
					"actions": [
						{
							"callFunction": "WriteMessageStatus",
							"sid": 386660938067806,
							"parameters": [
								"\"Logged in as '\" & Multiplayer.MyAlias & \"'\""
							]
						},
						{
							"id": "wait",
							"objectClass": "System",
							"sid": 498036226031888,
							"parameters": {
								"seconds": "2"
							}
						},
						{
							"id": "join-room",
							"objectClass": "Multiplayer",
							"sid": 482089341884111,
							"parameters": {
								"game": "GAME_NAME",
								"instance": "INSTANCE_NAME",
								"room": "lowercase(GamePlay_ID)",
								"max-peers": "2"
							}
						}
					],
					"sid": 513148688948342
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "on-joined-room",
							"objectClass": "Multiplayer",
							"sid": 381311611246526
						}
					],
					"actions": [
						{
							"id": "set-read-only",
							"objectClass": "ChatTextBox",
							"sid": 899398236470443,
							"parameters": {
								"mode": "not-read-only"
							}
						},
						{
							"id": "set-focused",
							"objectClass": "ChatTextBox",
							"sid": 242959498156933
						},
						{
							"id": "set-enabled",
							"objectClass": "SendButton",
							"sid": 162423381393745,
							"parameters": {
								"mode": "enabled"
							}
						}
					],
					"sid": 898885251291567,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "is-host",
									"objectClass": "Multiplayer",
									"sid": 738565795532005
								}
							],
							"actions": [
								{
									"id": "set-group-active",
									"objectClass": "System",
									"sid": 639751348555749,
									"parameters": {
										"group-name": "\"Host\"",
										"state": "activated"
									}
								},
								{
									"callFunction": "WriteTurnStatus",
									"sid": 956401944802774,
									"parameters": [
										"\"Host\""
									]
								}
							],
							"sid": 220049153344670
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "else",
									"objectClass": "System",
									"sid": 414899317904314
								}
							],
							"actions": [
								{
									"id": "set-group-active",
									"objectClass": "System",
									"sid": 290216546253091,
									"parameters": {
										"group-name": "\"Peer\"",
										"state": "activated"
									}
								},
								{
									"callFunction": "WriteTurnStatus",
									"sid": 418711129056720,
									"parameters": [
										"\"Guest\""
									]
								}
							],
							"sid": 367933019648986
						}
					]
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "on-left-room",
							"objectClass": "Multiplayer",
							"sid": 691671383921049
						}
					],
					"actions": [
						{
							"callFunction": "WriteMessageStatus",
							"sid": 144251061777138,
							"parameters": [
								"\"The other player left the game challenge\""
							]
						},
						{
							"id": "set-text",
							"objectClass": "WordListText",
							"sid": 887049585870440,
							"parameters": {
								"text": "\"\""
							}
						}
					],
					"sid": 164420636047244
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "on-disconnected",
							"objectClass": "Multiplayer",
							"sid": 388859887470274
						}
					],
					"actions": [
						{
							"callFunction": "WriteMessageStatus",
							"sid": 870361910415783,
							"parameters": [
								"\"The other player is disconnected\""
							]
						},
						{
							"id": "set-text",
							"objectClass": "WordListText",
							"sid": 569572197666726,
							"parameters": {
								"text": "\"\""
							}
						}
					],
					"sid": 122625326496169
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "on-error",
							"objectClass": "Multiplayer",
							"sid": 707302552664981
						}
					],
					"actions": [
						{
							"callFunction": "WriteMessageStatus",
							"sid": 791178931262166,
							"parameters": [
								"\"Signalling error: \" & Multiplayer.ErrorMessage"
							]
						}
					],
					"sid": 240571624620532
				}
			],
			"sid": 539663526026050
		},
		{
			"eventType": "group",
			"disabled": false,
			"title": "Game Play",
			"description": "Manages sending and retrieval of data over connection",
			"isActiveOnStart": true,
			"children": [
				{
					"eventType": "group",
					"disabled": false,
					"title": "Common - Game Play",
					"description": "Events that are common to both the host and peers.",
					"isActiveOnStart": true,
					"children": [
						{
							"eventType": "comment",
							"text": "When someone joins the chat, log a message in the chat box and add them to the peer list on the right."
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-peer-connected",
									"objectClass": "Multiplayer",
									"sid": 607027328210577
								}
							],
							"actions": [
								{
									"callFunction": "WriteMessageStatus",
									"sid": 738703468900942,
									"parameters": [
										"\"'\" & Multiplayer.PeerAlias & \"' joined\""
									]
								}
							],
							"sid": 132643389114303
						},
						{
							"eventType": "comment",
							"text": "When someone leaves the chat, log a message in the chat box and remove them from the peer list on the right."
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-peer-disconnected",
									"objectClass": "Multiplayer",
									"sid": 349057900452160
								}
							],
							"actions": [
								{
									"callFunction": "WriteMessageStatus",
									"sid": 559663585315201,
									"parameters": [
										"\"'\" & Multiplayer.PeerAlias & \"' left\""
									]
								}
							],
							"sid": 599512045423226
						},
						{
							"eventType": "comment",
							"text": "Log a message if we get kicked. This can happen if we could not connect to the host or if the host quit during the chat."
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-kicked",
									"objectClass": "Multiplayer",
									"sid": 861608412050875
								}
							],
							"actions": [
								{
									"callFunction": "WriteMessageStatus",
									"sid": 916737627336614,
									"parameters": [
										"\"Kicked (either could not connect to host or host quit)\""
									]
								},
								{
									"id": "set-text",
									"objectClass": "WordListText",
									"sid": 115822191070761,
									"parameters": {
										"text": "\"\""
									}
								}
							],
							"sid": 112085556267139
						}
					],
					"sid": 204629266537728
				},
				{
					"eventType": "group",
					"disabled": false,
					"title": "Peer - Game Play",
					"description": "Events specific to chat room peers (i.e. non-host users).",
					"isActiveOnStart": false,
					"children": [
						{
							"eventType": "comment",
							"text": "Non-empty chat messages can be sent with the 'Send' button or just hitting return."
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-clicked",
									"objectClass": "SendButton",
									"sid": 525250500717040
								},
								{
									"id": "on-key-pressed",
									"objectClass": "Keyboard",
									"sid": 884546698415754,
									"parameters": {
										"key": 13
									}
								}
							],
							"actions": [],
							"sid": 834534510142437,
							"children": [
								{
									"eventType": "comment",
									"text": "When we are a peer, we send our chat message to the host. The host will relay it to everyone else in the room."
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-text",
											"objectClass": "ChatTextBox",
											"sid": 507177771630383,
											"parameters": {
												"text": "\"\"",
												"case": "case-insensitive"
											},
											"isInverted": true
										}
									],
									"actions": [
										{
											"callFunction": "AddWord",
											"sid": 155937623253499,
											"parameters": [
												"\"<\" & Multiplayer.MyAlias & \"> \" & ChatTextBox.Text"
											]
										},
										{
											"id": "send-message",
											"objectClass": "Multiplayer",
											"sid": 250663825794933,
											"parameters": {
												"peer-id": "\"\"",
												"tag": "\"chat\"",
												"message": "ChatTextBox.Text",
												"mode": "reliable-ordered"
											}
										},
										{
											"id": "set-text",
											"objectClass": "ChatTextBox",
											"sid": 820608850414149,
											"parameters": {
												"text": "\"\""
											}
										}
									],
									"sid": 972743643170621
								}
							],
							"isOrBlock": true
						},
						{
							"eventType": "comment",
							"text": "When we receive a chat message from someone else, add it to the chat log."
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-peer-message",
									"objectClass": "Multiplayer",
									"sid": 601300570081376,
									"parameters": {
										"tag": "\"chat\""
									}
								}
							],
							"actions": [
								{
									"callFunction": "AddWord",
									"sid": 761181301315952,
									"parameters": [
										"\"<\" & Multiplayer.FromAlias & \"> \" & Multiplayer.Message"
									]
								}
							],
							"sid": 866195545900178
						}
					],
					"sid": 427526431786959
				},
				{
					"eventType": "group",
					"disabled": false,
					"title": "Host - Game Play",
					"description": "Events specific to the chat room host.",
					"isActiveOnStart": false,
					"children": [
						{
							"eventType": "comment",
							"text": "Non-empty chat messages can be sent with the 'Send' button or just hitting return."
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-clicked",
									"objectClass": "SendButton",
									"sid": 470987582111531
								},
								{
									"id": "on-key-pressed",
									"objectClass": "Keyboard",
									"sid": 474795308865812,
									"parameters": {
										"key": 13
									}
								}
							],
							"actions": [],
							"sid": 233249157231690,
							"children": [
								{
									"eventType": "comment",
									"text": "When we are the host, we immediately broadcast our own chat messages to everyone else in the room."
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-text",
											"objectClass": "ChatTextBox",
											"sid": 291173492310751,
											"parameters": {
												"text": "\"\"",
												"case": "case-insensitive"
											},
											"isInverted": true
										}
									],
									"actions": [
										{
											"callFunction": "AddWord",
											"sid": 380738603107158,
											"parameters": [
												"\"<\" & Multiplayer.MyAlias & \"> \" & ChatTextBox.Text"
											]
										},
										{
											"id": "broadcast-message",
											"objectClass": "Multiplayer",
											"sid": 914184607838019,
											"parameters": {
												"from-id": "\"\"",
												"tag": "\"chat\"",
												"message": "ChatTextBox.Text",
												"mode": "reliable-ordered"
											}
										},
										{
											"id": "set-text",
											"objectClass": "ChatTextBox",
											"sid": 479082672783585,
											"parameters": {
												"text": "\"\""
											}
										}
									],
									"sid": 350646810722186
								}
							],
							"isOrBlock": true
						},
						{
							"eventType": "comment",
							"text": "When we receive a chat message from someone else, we add it to the chat log, but then we must also relay it to everyone else in the chat room so they can all see what each other are sending. Note that the 'Broadcast' action does not send to the 'From ID' peer - there's no point sending them back the same message they just sent to us."
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-peer-message",
									"objectClass": "Multiplayer",
									"sid": 968448209036866,
									"parameters": {
										"tag": "\"chat\""
									}
								}
							],
							"actions": [
								{
									"callFunction": "AddWord",
									"sid": 393556578744950,
									"parameters": [
										"\"<\" & Multiplayer.FromAlias & \"> \" & Multiplayer.Message"
									]
								},
								{
									"id": "broadcast-message",
									"objectClass": "Multiplayer",
									"sid": 390408407093901,
									"parameters": {
										"from-id": "Multiplayer.FromID",
										"tag": "\"chat\"",
										"message": "Multiplayer.Message",
										"mode": "reliable-ordered"
									}
								}
							],
							"sid": 457630650261923
						}
					],
					"sid": 444853640601695
				}
			],
			"sid": 963658280062949
		},
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "on-start-of-layout",
					"objectClass": "System",
					"sid": 685476004098067
				}
			],
			"actions": [
				{
					"id": "set-text",
					"objectClass": "GamePlayIDText",
					"sid": 902589863671567,
					"parameters": {
						"text": "GamePlay_ID"
					}
				}
			],
			"sid": 463972877973936
		}
	],
	"sid": 234182000669496
}